<section id="scan" style="max-width:820px;margin:24px auto;padding:16px;border:1px solid #eee;border-radius:12px;background:#fff;font-family:system-ui">
  <h2>Gratis quick scan</h2>

  <form id="scanForm">
    <input id="scanUrl" type="url" placeholder="https://jouwsite.nl" required style="padding:10px;width:68%">
    <input id="scanEmail" type="email" placeholder="jij@bedrijf.nl" required style="padding:10px;width:68%;margin-top:6px">
    <button id="scanBtn" style="padding:10px 16px;margin-top:8px">Scan</button>
  </form>

  <div id="scanMsg" style="margin-top:10px;font-size:14px"></div>
</section>

<script>
const form = document.getElementById('scanForm');
const urlEl = document.getElementById('scanUrl');
const emailEl = document.getElementById('scanEmail');
const btn = document.getElementById('scanBtn');
const msg = document.getElementById('scanMsg');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  msg.textContent = '';
  btn.disabled = true; btn.textContent = 'Scannen...';

  try {
    const res = await fetch('/api/scan', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        url: urlEl.value.trim(),
        email: emailEl.value.trim()
      })
    });

    const data = await res.json().catch(()=>({ ok:false, error:'bad_json' }));
    if (res.ok && data.ok) {
      msg.innerHTML = `Klaar ✅ Score: <b>${data.score}</b> — 
        <a href="${data.report_url}" target="_blank" rel="noopener">Bekijk rapport</a>`;
    } else {
      msg.textContent = 'Mislukt: ' + (data.error || res.statusText);
    }
  } catch (err) {
    msg.textContent = 'Fout: ' + err.message;
  } finally {
    btn.disabled = false; btn.textContent = 'Scan';
  }
});
</script>
