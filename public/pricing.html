<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prijzen — GuardianLay</title>
  <meta name="description" content="Kies GuardianLay Quick Fix (eenmalig) of Pro (maandelijks). Veiligheid, consent en duidelijke rapporten." />
  <link rel="stylesheet" href="/style.css" />
  <meta property="og:title" content="Prijzen — GuardianLay" />
  <meta property="og:description" content="Kies GuardianLay Quick Fix of Pro. Snel compliant, helder rapport, NL-gericht." />
  <meta property="og:image" content="/assets/og-image.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <style>
    .pricing-hero{padding:28px 0 6px}
    .cards{display:grid;gap:16px}
    @media(min-width:900px){ .cards{grid-template-columns:1fr 1fr} }
    .price{font-size:34px;font-weight:800}
    .card img{width:100%;height:180px;object-fit:contain;background:#0e1524;border-radius:10px;margin-bottom:10px;border:1px solid #18233a}
    .muter{color:#9aa4b2;font-size:14px}
    .buy{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .note{margin-top:10px}
  </style>
</head>
<body>

  <!-- Header -->
  <header class="nav">
    <div class="container row" role="navigation" aria-label="Hoofdnavigatie">
      <a href="/" class="logo" style="display:flex;align-items:center;gap:10px;font-weight:800">
        <img src="/favicon.svg" alt="" width="24" height="24" />
        GuardianLay
      </a>
      <nav class="row" style="gap:8px">
        <a class="btn secondary" href="/">Home</a>
        <a class="btn secondary active" href="/pricing.html">Prijzen</a>
        <a class="btn" href="/#scan">Gratis quick scan</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="container pricing-hero">
      <h1 style="margin:.2em 0">Prijzen</h1>
      <p class="muted" style="max-width:720px">
        Kies wat nu past. <b>Quick Fix</b> is een eenmalig pakket om snel compliant te worden. <b>Pro</b> monitort maandelijks,
        voert her-scans uit en geeft updates/alerts. Beide met helder rapport, NL-gericht.
      </p>
    </section>

    <section class="container">
      <div class="cards">
        <!-- QUICK FIX -->
        <article class="card">
          <img src="/assets/quickfix.png" alt="GuardianLay Quick Fix" loading="lazy" />
          <h2 style="margin:.2em 0">Quick Fix</h2>
          <p class="muted">Eenmalig pakket: we leveren fixes & documentatie op. Ideaal om snel compliant te zijn.</p>
          <ul class="list" style="margin-top:10px">
            <li>Cookiebanner + Consent Mode v2 (advies/implementatie)</li>
            <li>Security headers baseline (CSP/HSTS/…)</li>
            <li>Deelbaar HTML-rapport & korte implementatiegids</li>
          </ul>
          <div class="price" id="price-quickfix">—</div>
          <div class="muter">eenmalig</div>
          <div class="buy">
            <button class="btn" id="buy-quickfix" data-plan="quickfix" disabled>Koop Quick Fix</button>
            <a class="btn secondary" href="/#waitlist">Vraag meer info</a>
          </div>
          <div class="muter note" id="msg-quickfix"></div>
        </article>

        <!-- PRO -->
        <article class="card">
          <img src="/assets/pro.png" alt="GuardianLay Pro" loading="lazy" />
          <h2 style="margin:.2em 0">Pro</h2>
          <p class="muted">Monitoring + her-scan, rapportage en updates. Voor continue zekerheid en prioriteitssupport.</p>
          <ul class="list" style="margin-top:10px">
            <li>Maandelijkse scan & rapport</li>
            <li>Wijzigingen-alerts (cookies/headers/consent)</li>
            <li>Prioriteitssupport & roadmap-updates</li>
          </ul>
          <div class="price" id="price-pro">—</div>
          <div class="muter">per maand</div>
          <div class="buy">
            <button class="btn" id="buy-pro" data-plan="pro" disabled>Neem Pro</button>
            <a class="btn secondary" href="/#waitlist">Vraag meer info</a>
          </div>
          <div class="muter note" id="msg-pro"></div>
        </article>
      </div>

      <p class="muter" id="pricing-msg" style="margin-top:16px"></p>
    </section>
  </main>

  <!-- Footer (zelfde als home) -->
  <footer class="footer">
    <div class="container row" style="flex-wrap:wrap;justify-content:space-between;gap:16px">
      <div>
        <div class="muted">© <span id="y"></span> GuardianLay</div>
        <div class="muted" style="font-size:13px">NL-gericht · Geen juridisch advies</div>
      </div>
      <nav class="row" style="gap:12px;flex-wrap:wrap">
        <a class="muted" href="/privacy.html">Privacy</a>
        <a class="muted" href="/cookies.html">Cookies</a>
        <a class="muted" href="/terms.html">Voorwaarden</a>
        <a class="muted" href="/sitemap.xml">Sitemap</a>
      </nav>
    </div>
  </footer>

  <script>
  // jaar
  document.getElementById('y').textContent = new Date().getFullYear();

  // utils
  const euro = cents => new Intl.NumberFormat('nl-NL',{ style:'currency', currency:'EUR' }).format((cents||0)/100);

  // tolerant fetch van /api/prices – ondersteunt meerdere vormen:
  // - [{id, unit_amount, recurring:{interval}, nickname}]  (Stripe list)
  // - { quickfix:'price_...', pro:'price_...' }            (eigen map)
  async function loadPrices(){
    const ui = {
      qm: document.getElementById('msg-quickfix'),
      pm: document.getElementById('msg-pro'),
      q:  document.getElementById('price-quickfix'),
      p:  document.getElementById('price-pro'),
      qb: document.getElementById('buy-quickfix'),
      pb: document.getElementById('buy-pro'),
      g:  document.getElementById('pricing-msg'),
    };

    try{
      const r = await fetch('/api/prices', { cache:'no-store' });
      if(!r.ok) throw new Error('HTTP '+r.status);
      const data = await r.json();

      let map = { quickfix:null, pro:null };

      // 1) Objectvorm
      if (data && !Array.isArray(data) && (data.quickfix || data.pro || data.PRICE_QUICKFIX || data.PRICE_PRO)) {
        map.quickfix = data.quickfix || data.PRICE_QUICKFIX || null;
        map.pro      = data.pro      || data.PRICE_PRO      || null;
      }

      // 2) Lijstvorm (Stripe)
      if (Array.isArray(data) || Array.isArray(data.prices)) {
        const list = Array.isArray(data) ? data : data.prices;
        // Heuristiek: recurring -> pro (subscription), non-recurring -> quickfix
        for (const p of list) {
          if (!p || !p.id) continue;
          const amount = p.unit_amount ?? p.unit_amount_decimal ?? null;
          const isSub  = !!p.recurring;
          if (isSub && !map.pro) {
            map.pro = p.id; ui.p.textContent = euro(amount);
          } else if (!isSub && !map.quickfix) {
            map.quickfix = p.id; ui.q.textContent = euro(amount);
          }
          // Als er nicknames zijn, overschrijf expliciet
          if (p.nickname) {
            if (/pro/i.test(p.nickname)) { map.pro = p.id; ui.p.textContent = euro(amount); }
            if (/fix|quick/i.test(p.nickname)) { map.quickfix = p.id; ui.q.textContent = euro(amount); }
          }
        }
      }

      // Als amounts nog niet zijn gezet (objectvorm), vraag eenmalig details op
      async function fillAmount(id, el){
        if(!id || !el || el.textContent !== '—') return;
        try {
          const pr = await fetch('/api/prices?id='+encodeURIComponent(id));
          if(pr.ok){
            const d = await pr.json();
            const item = Array.isArray(d) ? d.find(x=>x.id===id) : (d.price || d);
            const amt = item?.unit_amount ?? item?.unit_amount_decimal ?? null;
            if (amt!=null) el.textContent = euro(amt);
          }
        } catch {}
      }

      await Promise.all([
        fillAmount(map.quickfix, ui.q),
        fillAmount(map.pro, ui.p)
      ]);

      // Knoppen activeren
      if (map.quickfix) { ui.qb.dataset.priceId = map.quickfix; ui.qb.disabled = false; }
      if (map.pro)      { ui.pb.dataset.priceId = map.pro;      ui.pb.disabled = false; }

      if (!map.quickfix || !map.pro) {
        ui.g.textContent = 'Let op: niet alle prijzen konden worden geladen (controleer Vercel env vars & Stripe).';
      }

    } catch(err){
      console.error(err);
      document.getElementById('pricing-msg').textContent =
        'Kon prijzen niet laden. Controleer je /api/prices, Stripe-sleutels en Vercel-variables.';
    }
  }

  // Checkout
  async function goCheckout(priceId){
    try{
      const r = await fetch('/api/checkout', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ priceId })
      });
      const d = await r.json();
      if (r.ok && d?.url) { location.href = d.url; return; }
      alert('Kan checkout niet starten: '+(d?.error || r.status));
    }catch(e){
      alert('Netwerkfout bij starten checkout');
    }
  }

  // Events voor buy-knoppen
  function wireBuy(){
    document.querySelectorAll('button[id^="buy-"]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.dataset.priceId;
        if (!id) return alert('Prijs nog niet geladen. Probeer opnieuw.');
        goCheckout(id);
      });
    });
  }

  wireBuy();
  loadPrices();
  </script>
</body>
</html>
